var zipCheckout=Class.create();zipCheckout.prototype={_extensions:[],_btn:null,_zipBtn:null,_zipBtnId:"zipmoneypayment-place-order",_selectedPaymentCode:null,_onComplete:null,_onError:null,options:{methodCode:"zipmoneypayment"},initialize:function(){this._onComplete=this.onComplete.bind(this),this._onError=this.onError.bind(this)},setupZipPlaceOrderButton:function(){var e=this._btn.clone(!0);e.setAttribute("id",this._zipBtnId),this._btn.insert({before:e}),this._zipBtn=e},switchButtons:function(e){var t="",o=this._btn,i=this._zipBtn,n=[i,o];e||(t=this._selectedPaymentCode==this.options.methodCode?i:o),n.each(function(e){e&&(e==t?e.show():e.hide())})},onComplete:function(e){"approved"!=e.state&&"referred"!=e.state||(location.href=this.options.redirectUrl+"?result="+e.state+"&checkoutId="+e.checkoutId)},showError:function(e){var t="An error occurred while trying to checkout with zip.",o=e.detail.response.evalJSON();o.error&&(t=o.error),alert(t)},onError:function(e){this.showError(e)},checkout:function(){Zip.Checkout.init({redirect:this.options.redirect,checkoutUri:this.options.checkoutUri,redirectUri:this.options.redirectUrl,onComplete:this._onComplete,onError:this._onError})},getCurrentExtension:function(){var e=this,t=null;return this._extensions.each(function(o){o.name.toLowerCase()==e.options.checkoutExtension.toLowerCase()&&(t=new o["class"])}),t},setup:function(e){var t,o,i=this;try{this.options=Object.extend(this.options,e),t=i.getCurrentExtension(),console.log("Initializing zipMoney Checkout ... [ Checkout Extension :- "+e.checkoutExtension+" "+(void 0!=t?1:0)+" ] "),void 0!=t&&t.setup(this),o=document.URL.toQueryParams(),void 0!=o["zip-in-context"]&&"true"==o["zip-in-context"]&&this.checkout()}catch(n){console.log(n)}},register:function(e,t){this._extensions.push({"class":e,name:t})}},window.$zipCheckout=new zipCheckout;var Aitoc_Aitcheckout=Class.create();Aitoc_Aitcheckout.prototype={"super":null,_btn:null,initialize:function(e){this["super"]=e,this._btn=$("aitcheckout-place-order")},setup:function(e){this["super"]=e;var t=this;payment.currentMethod==this["super"].options.methodCode&&this._btn&&(this._btn.setAttribute("onclick",""),this._btn.observe("click",function(){t["super"].checkout()}))}},void 0!=window.$zipCheckout&&window.$zipCheckout.register(Aitoc_Aitcheckout,"Aitoc_Aitcheckout");var GoMage_Checkout=Class.create();GoMage_Checkout.prototype={"super":null,_btn:null,initialize:function(e){this["super"]=e,this._btn=$("place-order")},setup:function(e){this["super"]=e;var t=this;payment.currentMethod==this["super"].options.methodCode&&this._btn&&(this._btn.setAttribute("onclick",""),this._btn.observe("click",function(){t["super"].checkout()}))}},void 0!=window.$zipCheckout&&window.$zipCheckout.register(GoMage_Checkout,"GoMage_Checkout");var Zip_Idev_OnestepCheckout=Class.create();Zip_Idev_OnestepCheckout.prototype={"super":null,initialize:function(e){},setup:function(e){var t=this;this["super"]=e,this["super"]._btn=$("onestepcheckout-place-order"),this["super"]._selectedPaymentCode=payment.currentMethod,this["super"]._onComplete=this.onComplete.bind(this),this["super"]._onError=this.onError.bind(this),this["super"].setupZipPlaceOrderButton(),this["super"]._zipBtn.observe("click",this.idevCheckout.bind(this)),this["super"].switchButtons(),this.removeLoader(),this["super"]._btn.removeClassName("grey").addClassName("orange"),this["super"]._btn.disabled=!1,Ajax.Responders.register({onComplete:function(e,o){"undefined"==typeof e.parameters.doNotMakeAjaxCallback&&(t.methodChange(),t["super"].switchButtons())}})},showLoader:function(){var e=this["super"]._zipBtn,t=new Element("div").addClassName("onestepcheckout-place-order-loading").update('<img src="'+this["super"].options.loaderImageUrl+'" />&nbsp;&nbsp;Please wait, processing your order...');e.parentNode.appendChild(t)},removeLoader:function(){var e=this["super"]._zipBtn.parentNode.select("div.onestepcheckout-place-order-loading");e.length&&e[0].remove()},disablePlaceOrderButton:function(){this["super"]._zipBtn.removeClassName("orange").addClassName("grey"),this["super"]._zipBtn.disabled=!0},enablePlaceOrderButton:function(){this["super"]._zipBtn.removeClassName("grey").addClassName("orange"),this["super"]._zipBtn.disabled=!1},onComplete:function(e){"approved"==e.state||"referred"==e.state?location.href=this["super"].options.redirectUrl+"?result="+e.state+"&checkoutId="+e.checkoutId:(this.removeLoader(),this.enablePlaceOrderButton())},onError:function(e){this.removeLoader(),this.enablePlaceOrderButton(),this["super"].showError(e)},saveBilling:function(e,t,o){for(var i=$("onestepcheckout-form"),n=exclude_unchecked_checkboxes($$("input[name^=billing]").concat($$("select[name^=billing]"))),r=n.pluck("name"),s=n.pluck("value"),a={shipping_method:$RF(i,"shipping_method")},c=0,p=0;p<r.length;p++)if("payment[method]"!=r[p]){var u=r[p];"billing[street][]"==r[p]&&(u="billing[street]["+c+"]",c+=1),a[u]=s[p]}var h=$("billing:use_for_shipping_yes");if(h&&"1"!=h.getValue())for(var n=$$("input[name^=shipping]").concat($$("select[name^=shipping]")),l=n.pluck("name"),d=n.pluck("value"),c=0,p=0;p<l.length;p++)if("shipping_method"!=l[p]){var u=l[p];"shipping[street][]"==l[p]&&(u="shipping[street]["+c+"]",c+=1),a[u]=d[p]}return new Ajax.Request(e,{method:"post",parameters:a})},idevCheckout:function(e){var t=new VarienForm("onestepcheckout-form");already_placing_order=!1;var o=this["super"].options.baseUrl+"/onestepcheckout/ajax/save_billing",i=this["super"].options.baseUrl+"/onestepcheckout/ajax/set_methods_separate";if(console.log(o),console.log(i),t.validator.validate()){if(!already_placing_order&&$$(".loading-ajax").length<=0){already_placing_order=!0,this.showLoader(),this.disablePlaceOrderButton();var n=this.saveBilling(o,i,!1),r=this;n.options.onSuccess=function(){r["super"].checkout()}}}else Event.stop(e)},methodChange:function(){var e=$$('.payment-methods #checkout-payment-method-load input[name="payment[method]"]'),t=this;e.each(function(e){e.observe("click",function(){t["super"]._selectedPaymentCode=payment.currentMethod,t["super"].switchButtons()})})}},void 0!=window.$zipCheckout&&window.$zipCheckout.register(Zip_Idev_OnestepCheckout,"Idev_OnestepCheckout");var Zip_IWD_OPC=Class.create();Zip_IWD_OPC.prototype={"super":null,_btn:null,_zipBtn:null,_isV6:null,_zipBtnId:"zipmoneypayment_place_order",initialize:function(e){},setup:function(t){var o=this;this["super"]=t,this["super"]._btn=$("iwd_opc_place_order_button"),this["super"]._onComplete=this.onComplete.bind(this),this["super"]._onError=this.onError.bind(this),"undefined"!=typeof IWD&&"undefined"!=typeof IWD.OPC&&(this._isV6=!1,IWD.OPC.Plugin.event("saveOrder",function(){if("zipmoneypayment"==window.payment.currentMethod)return IWD.OPC.Checkout.saveOrderUrl=null,o["super"].checkout(),Event.stop(e),!0})),"undefined"!=typeof OnePage&&(this._isV6=!0,PaymentMethod.prototype.saveSection=function(){switch(this.getPaymentMethodCode()){case Singleton.get(PaymentMethodStripe).code:Singleton.get(PaymentMethodStripe).originalThis=o,Singleton.get(PaymentMethodStripe).originalArguments=_thisArguments,Singleton.get(PaymentMethodStripe).savePayment();break;case"zipmoneypayment":clearTimeout(Singleton.get(OnePage).validateTimeout),clearTimeout(Singleton.get(OnePage).blurTimeout),Singleton.get(OnePage).showLoader(Singleton.get(OnePage).sectionContainer),o["super"].checkout();break;default:OnePage.prototype.saveSection.apply(this,arguments)}})},onComplete:function(e){"approved"==e.state||"referred"==e.state?location.href=this["super"].options.redirectUrl+"?result="+e.state+"&checkoutId="+e.checkoutId:this._isV6?Singleton.get(OnePage).hideLoader(Singleton.get(OnePage).sectionContainer):(IWD.OPC.Checkout.hideLoader(),IWD.OPC.Checkout.unlockPlaceOrder(),IWD.OPC.saveOrderStatus=!1)},onError:function(e){this._isV6?Singleton.get(OnePage).hideLoader(Singleton.get(OnePage).sectionContainer):(IWD.OPC.Checkout.hideLoader(),IWD.OPC.Checkout.unlockPlaceOrder(),IWD.OPC.saveOrderStatus=!1),this["super"].showError(e)}},void 0!=window.$zipCheckout&&window.$zipCheckout.register(Zip_IWD_OPC,"IWD_OPC");var Zip_MageStore_OnestepCheckout=Class.create();Zip_MageStore_OnestepCheckout.prototype={"super":null,_btn:null,initialize:function(e){},setup:function(e){this["super"]=e,this["super"]._btn=$("onestepcheckout-button-place-order"),this["super"]._selectedPaymentCode=$RF(form,"payment[method]"),this["super"]._onComplete=this.onComplete.bind(this),this["super"]._onError=this.onError.bind(this),this["super"].setupZipPlaceOrderButton(),this["super"]._zipBtn.observe("click",this.magestoreCheckout.bind(this)),this["super"]._zipBtn.setAttribute("onclick",""),this["super"].switchButtons();var t=this;Ajax.Responders.register({onComplete:function(e,o){"undefined"==typeof e.parameters.doNotMakeAjaxCallback&&(t.methodChange(),t["super"].switchButtons(),t["super"]._selectedPaymentCode==t["super"].options.methodCode&&t.enablePlaceOrderButton())}})},onComplete:function(e){"approved"==e.state||"referred"==e.state?location.href=this["super"].options.redirectUrl+"?result="+e.state+"&checkoutId="+e.checkoutId:this.enablePlaceOrderButton()},onError:function(e){this.enablePlaceOrderButton(),this["super"].showError(e)},disablePlaceOrderButton:function(){this["super"]._zipBtn.removeClassName("onestepcheckout-btn-checkout").addClassName("place-order-loader"),this["super"]._zipBtn.disabled=!0},enablePlaceOrderButton:function(){this["super"]._zipBtn.removeClassName("place-order-loader").addClassName("onestepcheckout-btn-checkout"),this["super"]._zipBtn.disabled=!1},magestoreCheckout:function(){var e=($RF(form,"payment[method]"),new Validation("one-step-checkout-form"));already_placing_order=!1,!already_placing_order&&e.validate()&&checkpayment()&&(already_placing_order=!0,this.disablePlaceOrderButton(),this["super"].checkout())},methodChange:function(){var e=$$('#checkout-payment-method-load input[name="payment[method]"]'),t=this;e.each(function(e){e.observe("click",function(){t["super"]._selectedPaymentCode=$RF(form,"payment[method]"),t["super"].switchButtons()})})}},void 0!=window.$zipCheckout&&window.$zipCheckout.register(Zip_MageStore_OnestepCheckout,"MageStore_OnestepCheckout");var Zip_Mage_Checkout=Class.create();Zip_Mage_Checkout.prototype={"super":null,_payment:null,_transport:null,_btn:null,initialize:function(e){this["super"]=e,this._btn=$$(".btn-checkout")[0]},setup:function(e){this["super"]=e;var t=this;Payment.prototype.save=Payment.prototype.save.wrap(function(e){t._payment=this;var o=new Validation(this.form);this.validate()&&o.validate()&&("zipmoneypayment"==this.currentMethod?(checkout.setLoadWaiting("payment"),t.checkout()):e())})},onSuccess:function(transport,resolve,reject){if(transport&&transport.responseText)try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.error){if(response.fields){for(var fields=response.fields.split(","),i=0;i<fields.length;i++){var field=null;(field=$(fields[i]))&&Validation.ajaxError(field,response.error)}return}return void("string"==typeof response.message?alert(response.message):alert(response.error))}response.redirect_uri?resolve({data:{redirect_uri:response.redirect_uri}}):reject(),this._transport=transport},onComplete:function(e){this._payment.resetLoadWaiting(this._transport),"approved"==e.state?1==this["super"].options.redirectAfterPayment?(this.setOverlay(),location.href=this["super"].options.redirectUrl+"?result=approved&checkoutId="+e.checkoutId):this._payment.nextStep(this._transport):"referred"==e.state&&(this.setOverlay(),location.href=this["super"].options.redirectUrl+"?result=referred&checkoutId="+e.checkoutId)},setOverlay:function(){var e=new Element("div");e.update("<br/>Please wait. You are being redirected..."),e.addClassName("zipmoneypayment-overlay"),$(document.body).insert(e)},onError:function(e){var t="An error occurred while trying to checkout with zip.";e.detail.responseJSON.error&&(t=e.detail.responseJSON.error),alert(t),this._payment.resetLoadWaiting(this._transport)},onCheckout:function(e,t,o){var i=this;new Ajax.Request(this["super"].options.checkoutUri,{method:"post",onSuccess:function(o){i.onSuccess(o,e,t).bind(i)},onFailure:function(e){checkout.ajaxFailure.bind(checkout),t(e)},parameters:Form.serialize(this._payment.form)+"&review=true"})},checkout:function(){Zip.Checkout.init({redirect:this["super"].options.redirect,checkoutUri:this["super"].options.checkoutUri,redirectUri:this["super"].options.redirectUrl,onComplete:this.onComplete.bind(this),onError:this.onError.bind(this),onCheckout:this.onCheckout.bind(this)})}},void 0!=window.$zipCheckout&&window.$zipCheckout.register(Zip_Mage_Checkout,"Mage_Checkout");